#!/usr/bin/env bash

mkdir output

for image in *jpg; do

  info=$(identify "$image")

  size=$(awk '{print $7}' <<< $info | sed 's/\..KB//;s/KB//')
  geometry=$(awk '{print $3}' <<< $info )
  x=${geometry/x*/}
  y=${geometry/*x/}

  echo "$info"

  if [[ ${size/MB/} != $size ]] || (( $size > 500 )); then

    echo "converting"

    if (( x > y )); then
      convert "$image" -resize '1400' "output/$image"
    elif (( y > x )); then
      convert "$image" -resize 'x1400' "output/$image"
    fi

  else
    cp "$image" "output/$image"
  fi

done

