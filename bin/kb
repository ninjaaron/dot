#!/usr/bin/env bash

board="$1"
variant="${2:-extended}"

layout="usvi, tnk"
variant="$variant, grk"

case "$board" in
  hh*)
    setxkbmap -layout "$layout" -variant "$variant" \
      -option "grp:shifts_toggle"
     xmodmap -e 'keycode 135 = Menu'
     magic='BackSpace'
    ;;
  *)
    setxkbmap -layout "$layout" -variant "$variant" \
      -option "grp:shifts_toggle,ctrl:swapcaps"
     xmodmap -e 'keycode 135 = Super_R'
     magic='backslash'
    ;;
esac

killall xcape
if xcape; then
  xmodmap -e "keycode 36 = Control_R"  # keycode 36 is Return
  xmodmap -e "keycode 200 = Return"

  xmodmap -e "keycode 23 = Alt_L"
  xmodmap -e "keycode 201 = Tab"

  xmodmap -e "keycode 22 = Alt_R"
  xmodmap -e "keycode 203 = BackSpace ISO_Level5_Lock"

  xmodmap -e "keycode 65 = Shift_L"
  xmodmap -e "keycode 204 = space"

  # Finally use xcape to cause the space bar to generate a space when tapped.
  xcape -e \
"Control_R=Return;\
ISO_Level3_Shift=BackSpace;\
Alt_L=Tab;\
Alt_R=BackSpace;\
Shift_L=space"
fi
