#!/usr/bin/env bash

# get user configs
source $HOME/.dmenurc
source ~/.zshenv
DMENU="eval ${DMENU-dmenu}"

cmd=$({
    echo .
    echo -e "${PATH//:/\\n}" | while read dir; do
      ls "$dir"
    done
  } | $DMENU -p "exec:"
)

# if the user selects a directory, go there and execute brws.
echo $cmd
case "$cmd" in
  theme ) # changes the color scheme
    theme=$(ls $HOME/.themes|sed '/Ad/d ; /~$/d ; /xres/d'|\
      $DMENU -p 'themes:')
    theme $theme&
    ;;
  man )
    entry=$(
    (IFS=':'
    find $(manpath))|
    sed -n 's/.*\/\(.*\).1.gz/\1/p'|sort|
    $DMENU -p "man:")
    urxvtc -e $SHELL -c "man $entry"
    ;;
  bash*|fish*|ranger*|vim*|vi*|ed*|mocp*|info*|weechat*|htop|\
  bpython*|ipython*|python*|"man "* )
    urxvtc -e $SHELL -c "$cmd"
    ;;
  *)
    echo "$cmd"|${SHELL:-"/bin/sh"} &
esac

exit
